<%= render "devise/shared/header" %>
<div class='main'>
<h1>
  商品検索
</h1>

<div>

<%= search_form_for @p, url: search_item_path do |f| %>
<%= f.label :product_name_cont_any , '商品名で一致するキーワード：' %>
  <%= f.search_field :product_name_cont_any, class: "form-control" %>
  <br>
  <%= f.label :description_cont_any , '商品説明で一致するキーワード：' %>
  <%= f.search_field :description_cont_any, class: "form-control" %>
  <br>
  <%= f.label :condition_id_eq, '商品の状態：' %>
  <%= f.collection_select :condition_id_eq, Condition.all.where.not(id: 0), :id, :name, include_blank: '指定なし' %>
  <br>
  <%= f.label :delivery_burden_id_eq, '配送料の負担：' %>
  <%= f.collection_select :delivery_burden_id_eq, DeliveryBurden.all.where.not(id: 0), :id, :name, include_blank: '指定なし' %>
  <br>
  <%= f.label :shipping_day_id_eq, '発送までの日数：' %>
  <%= f.collection_select :shipping_day_id_eq, ShippingDay.all.where.not(id: 0), :id, :name, include_blank: '指定なし' %>
  <br>
  <%= f.label :category_name_eq, 'カテゴリー：' %>
          <%# <%= f.collection_select(:category_id, @parents, :id, :name, { include_blank: "---", selected:"" }, {class:"select-box1", id:"category_form"}) %> %>

  <%= f.collection_select :category_name_eq, @category_name, :name, :name, include_blank: '指定なし', class:"select-box1" %>
                  <div id="category_field"></div>
<br>
  
  <%= f.label :price, "価格：" %>
  <%= f.number_field :price_gteq ,placeholder:"片方だけの入力でもOK" %>
  <%= f.label :price, " 〜 " %>
  <%= f.number_field :price_lteq ,placeholder:"片方だけの入力でもOK" %>
  <br>
  <%= f.submit '検索' %>
  
</div>

<div>
検索結果
  <%= @results.count %>件

  <br>
     検索結果の並び替え：
     <%=  f.select( :sorts, { '出品(編集)の新しい順': 'updated_at desc', '出品(編集)の古い順': 'updated_at asc', '価格の安い順': 'price asc', '価格の高い順': 'price desc' } , { selected: params[:q][:sorts] } , { onchange: 'this.form.submit()'} ) %>

</div>
  <%# 商品一覧 %>
  <div class='item-contents'>
    <h2 class='title'>検索商品一覧</h2>
  <% if @results.length !=0 %>
    <ul class='item-lists'>  
    <% @results.each do |result| %>
      <li class='list'>
        <%= link_to item_path(result.id) do %>
          <div class='item-img-content'>
            <%= image_tag url_for(result.images[0]) , class: "item-img" %>
              <% if result.item_transaction.present? %>
              <div class='sold-out'>
                <span>Sold Out!!</span>
              </div>
              <% end %>
            <% end %>
          </div>
          <div class='item-info'>
            <h3 class='item-name'>
              <%= result.product_name %>
            </h3>
            <div class='item-price'>
              <span><%= result.price.to_s(:delimited) %>円<br>(税込み)</span>
                  <div class='star-btn'>
                  <%= link_to item_favorites_path(result.id) do %>
                  <%= image_tag "star.png", class:"star-icon"  %>
                  <span class='star-count'><%= result.favorites.count %></span>
                  <% end %>
                  </div>
            </div>
          </div>
        <% end %>
      </li>
      </ul>
      
    
  <% else %>
    該当する商品はありません
  <% end %>
      
      
    
<% end %>
  <%# /商品一覧 %>
  
</div>

<div class='purchase-btn'>
  <span class='purchase-btn-text'>出品する</span>
    <%= link_to new_item_path do %>
    <%= image_tag 'camera.png' , size: '185x50' ,class: "purchase-btn-icon" %>
  <% end %>
</div>
<%= render "devise/shared/footer" %>